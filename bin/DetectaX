<<<<<<< HEAD
#! /bin/bash

### VARIABLES ###

CICLE=0
=======
### VARIABLES ###


CANLOOP=10000
CICLE=0
TESPERA=60
MINYEAR=2000
>>>>>>> 154a02fc027ca7e795aa09b0f9c1f3131350d72f


#######################################################


### FUNCIONES ###

#Procesar un archivo de ARRIDIR.
processArridirFile() {
	local rejected=0;
	if [ -f "$1" ]
	then
		local file="${1##*/}"
		local country="${file%%-*}"
		local untilSystem="${file#*-}"
		local system="${untilSystem%%-*}"
		grep -q "$country-.*-$system" "$MAEDIR/p-s.mae"
		local returnCode=$?
		if [ $returnCode -ne 0 ]
		then
			rejected=1
		fi
		local untilYear="${untilSystem#*-}"
		local year="${untilYear%%-*}"
		local month="${untilYear#*-}"
<<<<<<< HEAD
		if [ \( $year -gt 2000 \) -a \( $year -le $(date +%Y) \) -a \( $month -ge 1 \) -a \( $month -le 12 \) ]
=======
		if [ \( $year -gt $MINYEAR \) -a \( $year -le $(date +%Y) \) -a \( $month -ge 1 \) -a \( $month -le 12 \) ]
>>>>>>> 154a02fc027ca7e795aa09b0f9c1f3131350d72f
		then
			if [ $year -eq $(date +%Y) ]
			then
				if [ $month -gt $(date +%m) ]
				then
					rejected=1
				fi
			fi
		else
			rejected=1
		fi
	else
		rejected=1
	fi
	if [ $rejected -eq 1 ]
	then
<<<<<<< HEAD
		source MoverX "$file" "$ARRIDIR" "$RECHDIR"
		#GRABAR EN EL LOG
	else
		source MoverX "$file" "$ARRIDIR" "$ACEPDIR"
		#GRABAR EN EL LOG
=======
		echo "$file: Rechazado."
		#MOVER A RECHDIR
	else
		echo "$file: Aceptado."
		#MOVER A ACEPDIR
>>>>>>> 154a02fc027ca7e795aa09b0f9c1f3131350d72f
	fi
}

#Procesar un archivo de ACEPDIR
processAcepdirFile() {
	echo "InterpreteX"
<<<<<<< HEAD
	#source InterpreteX
=======
	#InterpreteX
>>>>>>> 154a02fc027ca7e795aa09b0f9c1f3131350d72f
	#MOSTRAR PROCESS ID, ETC
}


#######################################################


### BLOQUE PRINCIPAL ###

#Detectar si existen archivos en ARRIDIR.
while [ $CICLE -le $CANLOOP ]
do
	((CICLE++))
	#GRABAR EN EL LOG NUMERO DE CICLO

	if [ "$(ls -A "$ARRIDIR")" ]
	then
		files=$(ls "$ARRIDIR")
		for file in $files
		do
			processArridirFile "$ARRIDIR/$file"
		done
	fi

	if [ "$(ls -A "$ACEPDIR")" ]
	then
		files=$(ls "$ARRIDIR")
		for file in $files
		do
			processAcepdirFile "$ACEPDIR/$file"
		done
	fi
	sleep $TESPERA
done
